<!-- Bot√£o flutuante ‚Äú+‚Äù para abrir o modal -->
<button class="add-btn" (click)="modalAberto = true">+</button>

<!-- Modal de cria√ß√£o/edi√ß√£o de ve√≠culo (sem upload de imagem) -->
<div class="modal" [style.display]="modalAberto ? 'flex' : 'none'">
  <div class="card">

    <!-- Cabe√ßalho fixo -->
    <div class="modal-header">
      <h2>{{ selectedCardIndex !== null ? 'Editar Ve√≠culo' : 'Novo Ve√≠culo' }}</h2>
      <button class="close-btn" (click)="fecharModal()">X</button>
    </div>

    <!-- Conte√∫do scroll√°vel -->
    <div class="modal-body">
      <!-- Upload de Imagem -->
      <div class="upload-section">
        <label for="fileInput">Selecionar Imagem:</label>
        <input type="file" id="fileInput" (change)="onFileSelected($event)" accept="image/png, image/jpeg" />

        <div class="image-preview" *ngIf="imagePreview">
          <p>Preview:</p>
          <img [src]="imagePreview" alt="Preview da Imagem" />
        </div>
      </div>

      <!-- Inputs de texto (numera√ß√£o, modelo, marca, ano, km atual) -->
      <div class="input-group">
        <div class="input-item">
          <input type="text" [(ngModel)]="numeracao" placeholder="Numera√ß√£o" #numeracaoInput="ngModel" required />
          <div *ngIf="numeracaoInput.invalid && numeracaoInput.touched" class="error-message">
            Numera√ß√£o √© obrigat√≥ria.
          </div>
        </div>

        <div class="input-item">
          <input type="text" [(ngModel)]="modelo" placeholder="Modelo" #modeloInput="ngModel" required />
          <div *ngIf="modeloInput.invalid && modeloInput.touched" class="error-message">
            Modelo √© obrigat√≥rio.
          </div>
        </div>

        <div class="input-item">
          <input type="text" [(ngModel)]="marca" placeholder="Marca" #marcaInput="ngModel" required />
          <div *ngIf="marcaInput.invalid && marcaInput.touched" class="error-message">
            Marca √© obrigat√≥ria.
          </div>
        </div>

        <div class="input-item">
          <input type="number" [(ngModel)]="anoModelo" placeholder="Ano Modelo" #anoModeloInput="ngModel" required />
          <div *ngIf="anoModeloInput.invalid && anoModeloInput.touched" class="error-message">
            Ano Modelo √© obrigat√≥rio.
          </div>
        </div>

        <div class="input-item">
          <!-- Alterado para text, com m√°scara de d√≠gitos -->
          <input type="text" [(ngModel)]="kmAtual" placeholder="KM Atual" #kmAtualInput="ngModel"
            (input)="formatarQuilometragem($event, 'kmAtual')" maxlength="7" required />
          <div *ngIf="kmAtualInput.invalid && kmAtualInput.touched" class="error-message">
            KM Atual √© obrigat√≥rio.
          </div>
        </div>
      </div>

      <!-- Campos de select (situa√ß√£o, placa, lota√ß√£o, categoria, km pr√≥ximas trocas) -->
      <div class="select-group">
        <div class="select-item">
          <select [(ngModel)]="situacao" #situacaoInput="ngModel" required>
            <option value="Ativo">Ativo</option>
            <option value="Inativo">Inativo</option>
            <option value="Manutencao">Manuten√ß√£o</option>
          </select>
          <div *ngIf="situacaoInput.invalid && situacaoInput.touched" class="error-message">
            Situa√ß√£o √© obrigat√≥ria.
          </div>
        </div>

        <div class="input-item">
          <!-- Adicionada chamada ao m√©todo de formata√ß√£o -->
          <input type="text" [(ngModel)]="placa" placeholder="Placa" #placaInput="ngModel" (input)="formatPlaca($event)"
            maxlength="8" required />
          <div *ngIf="placaInput.invalid && placaInput.touched" class="error-message">
            Placa √© obrigat√≥ria.
          </div>
        </div>

        <div class="input-item">
          <input type="number" [(ngModel)]="lotacao" placeholder="Lota√ß√£o" #lotacaoInput="ngModel" required />
          <div *ngIf="lotacaoInput.invalid && lotacaoInput.touched" class="error-message">
            Lota√ß√£o √© obrigat√≥ria.
          </div>
        </div>

        <div class="select-item">
          <select [(ngModel)]="categoria" #categoriaInput="ngModel" required>
            <option value="Rodoviario">Rodovi√°rio</option>
            <option value="Urbano">Urbano</option>
          </select>
          <div *ngIf="categoriaInput.invalid && categoriaInput.touched" class="error-message">
            Categoria √© obrigat√≥ria.
          </div>
        </div>

        <div class="input-item">
          <!-- Alterado para text, com m√°scara de d√≠gitos -->
          <input type="text" [(ngModel)]="kmProxTrocaOleo" placeholder="KM Pr√≥xima Troca de √ìleo"
            #kmProxTrocaOleoInput="ngModel" (input)="formatarQuilometragem($event, 'kmProxTrocaOleo')" maxlength="7" />
        </div>

        <div class="input-item">
          <!-- Alterado para text, com m√°scara de d√≠gitos -->
          <input type="text" [(ngModel)]="kmProxTrocaPneu" placeholder="KM Pr√≥xima Troca de Pneu"
            #kmProxTrocaPneuInput="ngModel" (input)="formatarQuilometragem($event, 'kmProxTrocaPneu')" maxlength="7" />
        </div>
      </div>

      <!-- Checkboxes de opcionais -->
      <div class="checkbox-group">
        <div class="checkbox-item">
          <input type="checkbox" [(ngModel)]="arCondicionado" />
          <span>Ar Condicionado</span>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" [(ngModel)]="wifi" />
          <span>Wi-Fi</span>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" [(ngModel)]="poltronaReclinavel" />
          <span>Poltrona Reclin√°vel</span>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" [(ngModel)]="tv" />
          <span>TV</span>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" [(ngModel)]="geladeira" />
          <span>Geladeira</span>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" [(ngModel)]="sanitarios" />
          <span>Sanit√°rios</span>
        </div>
      </div>
    </div>
    <!-- Bot√µes de a√ß√£o no modal -->
    <div class="buttons">
      <button class="btn green" (click)="adicionarCard()" [disabled]="loading">
        <span *ngIf="!loading">Salvar</span>
        <span *ngIf="loading">
          <span class="spinner"></span> Salvando...
        </span>
      </button>
      <button class="btn red" (click)="modalAberto = false">
        Cancelar
      </button>
    </div>
  </div>
</div>


<!-- Cabe√ßalho -->
<div class="center">
  <h2>Frota</h2>
</div>
<div class="subtitle">
  <h2>Todos os ve√≠culos inseridos no sistema. Ve√≠culos inativos n√£o aparecer√£o no site.</h2>
</div>
<!-- Grid de exibi√ß√£o dos ve√≠culos j√° cadastrados -->
<div class="cards-container">
  <div class="veiculo-card" *ngFor="let resultado of cardsGerados; let i = index"
    [ngStyle]="getCardBackgroundStyle(resultado)">
    <div class="veiculo-info">
      <h3>{{ resultado.veiculo.modelo }} ‚Äì {{ resultado.veiculo.marca }}</h3>
      <p><strong>Numera√ß√£o:</strong> {{ resultado.veiculo.numeracao }}</p>
      <p><strong>Ano Modelo:</strong> {{ resultado.veiculo.anoModelo }}</p>
      <p><strong>KM Atual:</strong> {{ resultado.veiculo.kmAtual }}</p>
      <p><strong>Situa√ß√£o:</strong> {{ resultado.veiculo.situacao }}</p>
      <p><strong>Pr√≥x. Troca √ìleo:</strong> {{ resultado.veiculo.kmProxTrocaOleo }}</p>
      <p><strong>Pr√≥x. Troca Pneu:</strong> {{ resultado.veiculo.kmProxTrocaPneu }}</p>
      <p><strong>Placa:</strong> {{ resultado.veiculo.placa }}</p>
      <p><strong>Lota√ß√£o:</strong> {{ resultado.veiculo.lotacao }}</p>
      <p><strong>Categoria:</strong> {{ resultado.veiculo.categoria }}</p>

      <div class="veiculo-itens">
        <p><strong>Opcionais:</strong></p>
        <span *ngIf="resultado.veiculo.arCondicionado">‚ùÑ Ar Condicionado</span>
        <span *ngIf="resultado.veiculo.wifi">üì∂ Wi-Fi</span>
        <span *ngIf="resultado.veiculo.poltronaReclinavel">üí∫ Poltrona</span>
        <span *ngIf="resultado.veiculo.tv">üì∫ TV</span>
        <span *ngIf="resultado.veiculo.geladeira">üßä Geladeira</span>
        <span *ngIf="resultado.veiculo.sanitarios">üöª Sanit√°rios</span>
      </div>
    </div>

    <div class="card-actions">
      <button class="btn red" (click)="excluirCard(i)">Excluir</button>
      <button class="btn green" (click)="editarCard(i)">Editar</button>
    </div>
  </div>
</div>